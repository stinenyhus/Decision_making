---
title: "sum_and_plot"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Run if UCloud instance is fresh
```{r}
install.packages("pacman")
```

### Load packages and functions
```{r}
library(pacman)
p_load(gdtools, ggplot2, ggthemes, Hmisc, ggpubr, patchwork, stringr, tidyverse)
# setwd("/work/Exam/decision_making")
source("functions/post_sim_functions.R")
```

### Get folders, read data and sum
List folder
```{r}
folders = list.dirs(file.path("data"))
folders = folders[2:length(folders)] # Remove the first one that is just "data"
folders
```


Sum data
```{r}
out = sum_multiple_results(folders, saturations = c(0.20,0.50,0.99))
data_summed = out[[1]]
degree_distribution = out[[2]]
point_estimates = out[[3]]
```

### Result plots
Baseline
```{r}
base_plot <- data_summed %>% 
  subset(baseline==T) %>% 
  subset(round<=35) %>% 
  plot_standard_by_name(title = "Baseline simulations")
base_plot
ggsave("fig/Baseline_saturation.png", base_plot, width = 12, height = 6)
```


```{r}
palette <- brewer.pal(8,"Dark2")
```


```{r}
high_status_plot <- data_summed %>% 
  subset(status!=F) %>% 
  subset(round<=35) %>% 
    ggplot(aes(round, 
               sumadopt, 
               color = interaction(str_wrap(name,20), status, sep=", status="),
               linetype = interaction(str_wrap(name,20), status, sep = ", status=")))+
        geom_line(size = 0.7)+
        theme_minimal()+
        theme(text = element_text(size = 20, family = "serif"), 
              legend.key.height = unit(1,"cm"),
              legend.text = element_text(size=15),
              legend.position = "bottom")+
        scale_color_brewer(palette = "Dark2")+
  scale_color_manual(name="",
                     values=c(palette[4], palette[5], palette[6], 
                              palette[4], palette[5], palette[6],
                              palette[4], palette[5], palette[6]),
                     guide = guide_legend(nrow=3,ncol=3))+
  scale_linetype_manual(name="",
                        values = c(1,1,1,2,2,2,3,3,3),
                        guide = guide_legend(nrow=3,ncol=3))+
  labs(title = "High status", 
       x = "Rounds", 
       y = "Number of activated nodes", 
       color = "Simulation")
high_status_plot
ggsave("fig/high_status_saturation.png", high_status_plot, width = 12, height = 6)
```

```{r}
high_degree_plot <- data_summed %>% 
  subset(degree!=F) %>% 
  subset(round<=35) %>% 
    ggplot(aes(round, 
               sumadopt, 
               color = interaction(str_wrap(name,20), degree, sep=", degree="),
               linetype = interaction(str_wrap(name,20), degree, sep = ", degree=")))+
        geom_line(size = 0.7)+
        theme_minimal()+
        theme(text = element_text(size = 20, family = "serif"), 
              legend.key.height = unit(1,"cm"),
              legend.text = element_text(size=15),
              legend.position = "bottom")+
        scale_color_brewer(palette = "Dark2")+
  scale_color_manual(name="",
                     values=c(palette[4], palette[5], palette[6], 
                              palette[4], palette[5], palette[6],
                              palette[4], palette[5], palette[6]),
                        guide = guide_legend(nrow=3,ncol=3))+
  scale_linetype_manual(name="",
                        values = c(1,1,1,2,2,2,3,3,3),
                        guide = guide_legend(nrow=3,ncol=3))+
  labs(title = "High degree", 
       x = "Rounds", 
       y = "Number of activated nodes", 
       color = "Simulation")
high_degree_plot
ggsave("fig/high_degree_saturation.png", high_degree_plot, width = 12, height = 6)

```


#### Results plot, many ####


High status = 0.5
```{r}
status_0.5_plot <- data_summed %>% subset(status == "0.5") %>% 
  plot_standard_by_name(title="High status = 0.5% of tau")
status_0.5_plot
ggsace("fig/Status0.5_saturation.png", status_0.5_plot, width = 12, heigh = 6)
```

High status = 0.75
```{r}
status_0.75_plot <- data_summed %>% subset(status == "0.75") %>% 
  plot_standard_by_name(title="High status = 0.75% of tau")
ggsave("fig/Status0.75_saturation.png", status_0.75_plot, width = 12, height = 6)
```

High status = 1
```{r}
status_1_plot <- data_summed %>% subset(status == "1") %>% 
  plot_standard_by_name(title="High status = 100% of tau")
ggsave("fig/Status1_saturation.png", status_1_plot, width = 12, height = 6)
```

High degree = 24 connections
```{r}
degree_24_plot <- data_summed %>% subset(degree == "24") %>% 
  plot_standard_by_name(title = "High degree = 24 connections")
ggsave("fig/Degree24_saturation.png", degree_24_plot, width = 12, height = 6)
```

High degree = 48 connections
```{r}
degree_48_plot <- data_summed %>% subset(degree == "48") %>% 
  plot_standard_by_name(title = "High degree = 48 connections")
ggsave("fig/Degree48_saturation.png", degree_48_plot, width = 12, height = 6)
```

High degree = 96 connections
```{r}
degree_96_plot <- data_summed %>% subset(degree == "96") %>% 
  plot_standard_by_name(title = "High degree = 96 connections")
ggsave("fig/Degree96_saturation.png", degree_96_plot, width = 12, height = 6)
```




### Degree distribution plots

Getting mean degree under different conditions
```{r}
#This is just all simulation where high degree = FALSE, so they should all have similar degree
means_standard <- degree_distribution %>% subset(degree==F) %>% mean_degree()

#The different high degree conditions
means_24 <- degree_distribution %>% subset(degree=="24") %>% mean_degree()
means_48 <- degree_distribution %>% subset(degree=="48") %>% mean_degree()
means_96 <- degree_distribution %>% subset(degree=="96") %>% mean_degree()

```


plotting standard, i.e., high degree = FALSE
```{r}
degree_standard_plot <- plot_degree_distribution(means_standard, title = "Standard degree distribution")
degree_standard_plot
ggsave("fig/degree_distribution_standard.png", degree_standard_plot, width = 12, height = 6)
```

plotting high degree = TRUE
```{r}
degree_24_plot <- plot_degree_distribution(means_24, title = "Degree distribution for high degree = 24")
degree_24_plot
degree_96_plot <- plot_degree_distribution(means_96, title = "Degree distribution for high degree = 96")
degree_96_plot
```













